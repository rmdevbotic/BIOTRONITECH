<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title></title>
</head>
<body>
<script>
(async () => {
  const BOTMAKER_URL = "https://api.botmaker.com/v2.0/constants/BIOTRONITECH_IPList";
  const TOKEN = "eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJGZWxpcGUgQ2FzdHJvIiwiYnVzaW5lc3NJZCI6ImJpb3Ryb25pdGVjaGNvbG9tYmlhc2FzIiwibmFtZSI6IkZlbGlwZSBDYXN0cm8iLCJhcGkiOnRydWUsImlkIjoiWTdwUnFYNmJYcVcwdFRlWGFianIwb01Ma1ZqMiIsImV4cCI6MTkxNzU1NDgzOSwianRpIjoiWTdwUnFYNmJYcVcwdFRlWGFianIwb01Ma1ZqMiJ9.ssfoPx1Af8Cz9f47u5ed6L0Wgq_nQ7odMK3QtZCp0tV_VxASAflyzCWmOn7toPOSo_o1TwYu5TSNNSxZIcbcdg";
  const IP_SERVICE = "https://api.ipify.org?format=json";
  const REDIRECT_TO = "https://biotronitech.com.co/autorizacion-tratamiento-de-datos-personales/";

  try {
    const ipResp = await fetch(IP_SERVICE, { cache: "no-store" });
    const { ip } = await ipResp.json();

    const now = new Date();
    const fecha = now.toISOString().split("T")[0];
    const hora = now.toTimeString().split(" ")[0]; 
    const ipConFecha = `${ip},${fecha} ${hora}`;

    const getResp = await fetch(BOTMAKER_URL, {
      headers: { "access-token": TOKEN }
    });
    const data = await getResp.json();

    const valorActual = data.value || "";
    const nuevoValor = valorActual ? valorActual + "//" + ipConFecha : ipConFecha;

    await fetch(BOTMAKER_URL, {
      method: "PATCH",
      headers: {
        "Content-Type": "application/json",
        "access-token": TOKEN
      },
      body: JSON.stringify({ value: nuevoValor })
    });
  } catch (err) {
    console.error("Error:", err);
  } finally {
    window.location.replace(REDIRECT_TO);
  }
})();
</script>
</body>
</html>
